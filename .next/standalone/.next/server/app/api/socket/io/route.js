"use strict";(()=>{var e={};e.id=385,e.ids=[385],e.modules={8447:e=>{e.exports=require("bufferutil")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7838:e=>{e.exports=require("utf-8-validate")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},3477:e=>{e.exports=require("querystring")},2781:e=>{e.exports=require("stream")},9512:e=>{e.exports=require("timers")},4404:e=>{e.exports=require("tls")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},1559:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>q});var s={};r.r(s),r.d(s,{GET:()=>p,dynamic:()=>u,runtime:()=>d});var o=r(5419),a=r(9108),i=r(9678),n=r(2239);let u="force-dynamic",d="nodejs",l=new Map;async function p(e){if("websocket"!==e.headers.get("upgrade"))return new Response("Expected Upgrade: websocket",{status:426});try{let t=await fetch(e.url,{headers:e.headers,method:e.method});return new Response(null,{status:101,headers:t.headers})}catch(e){return new Response(null,{status:500})}}global.io||(global.io=new n.xF({cors:{origin:"*",methods:["GET","POST"],credentials:!0},path:"/api/socket/io"}),global.io.on("connection",e=>{console.log("Client connected:",e.id),e.on("create-classroom",t=>{let r;do r=Math.random().toString(36).substring(2,8).toUpperCase();while(l.has(r));l.set(r,{teacherId:t,students:new Map,canvasStates:new Map}),e.join(r),e.emit("classroom-created",{classCode:r,teacherId:t})}),e.on("join-classroom",t=>{let{classCode:r,studentId:s,displayName:o}=t,a=l.get(r);if(!a){e.emit("error",{message:"Classroom not found"});return}a.students.set(s,{displayName:o}),e.join(r),global.io.to(r).emit("student-joined",{studentId:s,displayName:o,students:Array.from(a.students.entries()).map(([e,t])=>({id:e,displayName:t.displayName}))});let i=a.canvasStates.get(s);i&&e.emit("load-canvas",{studentId:s,canvasData:i}),e.emit("name-assigned",{displayName:o})}),e.on("draw-update",e=>{let{classCode:t,studentId:r,drawData:s,canvasState:o}=e,a=l.get(t);a&&(a.canvasStates.set(r,o),global.io.to(t).emit("draw-update-received",{studentId:r,drawData:s,canvasState:o}))}),e.on("request-canvas-state",t=>{let{classCode:r,studentId:s}=t,o=l.get(r);if(o){let t=o.canvasStates.get(s);t&&e.emit("canvas-state-update",{studentId:s,canvasState:t})}}),e.on("disconnecting",()=>{for(let[t,r]of(console.log("Client disconnected:",e.id),l.entries()))r.students.has(e.id)&&(r.students.delete(e.id),r.canvasStates.delete(e.id),global.io.to(t).emit("student-left",{students:Array.from(r.students.entries()).map(([e,t])=>({id:e,displayName:t.displayName}))}),0===r.students.size&&r.teacherId===e.id&&l.delete(t))})}));let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/socket/io/route",pathname:"/api/socket/io",filename:"route",bundlePath:"app/api/socket/io/route"},resolvedPagePath:"/Users/alexlautin/Documents/GitHub/emoryhacks25/app/api/socket/io/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:x,staticGenerationBailout:q}=c,f="/api/socket/io/route";function v(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,665],()=>r(1559));module.exports=s})();