(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4392:function(e,t,r){Promise.resolve().then(r.bind(r,4167))},4167:function(e,t,r){"use strict";let s;r.r(t),r.d(t,{default:function(){return I}});var a=r(7437),n=r(2265),o=r(6782),l=r(9143),i=r(9769),d=r(3167),c=r(1367);function u(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,c.m6)((0,d.W)(t))}let f=(0,i.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),x=n.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:o=!1,...i}=e,d=o?l.g7:"button";return(0,a.jsx)(d,{className:u(f({variant:s,size:n,className:r})),ref:t,...i})});x.displayName="Button";var h=r(5056);let p=h.zt,m=h.fC,g=h.xz,b=n.forwardRef((e,t)=>{let{className:r,sideOffset:s=4,...n}=e;return(0,a.jsx)(h.VY,{ref:t,sideOffset:s,className:u("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...n})});b.displayName=h.VY.displayName;var j=r(1683);let v=j.fC,w=j.xz,N=n.forwardRef((e,t)=>{let{className:r,align:s="center",sideOffset:n=4,...o}=e;return(0,a.jsx)(j.h_,{children:(0,a.jsx)(j.VY,{ref:t,align:s,sideOffset:n,className:u("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...o})})});N.displayName=j.VY.displayName;var y=r(1014);let C=n.forwardRef((e,t)=>{let{className:r,orientation:s="horizontal",decorative:n=!0,...o}=e;return(0,a.jsx)(y.f,{ref:t,decorative:n,orientation:s,className:u("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",r),...o})});C.displayName=y.f.displayName;var k=r(7907);function _(e){let{socket:t,studentId:r,classCode:s,isTeacher:o,onBoardClick:l,selectedStudentId:i}=e,d=(0,n.useRef)(null),[c,u]=(0,n.useState)(!1),[f,h]=(0,n.useState)("#000000"),[j,y]=(0,n.useState)("draw"),[_,z]=(0,n.useState)(null),[S,R]=(0,n.useState)(null);(0,k.useRouter)(),(0,n.useEffect)(()=>{let e=d.current;if(!e)return;let a=e.getContext("2d");if(a)return e.width=800,e.height=600,a.fillStyle="#ffffff",a.fillRect(0,0,800,600),o&&i&&t.emit("request-canvas-state",{classCode:s,studentId:i}),t.on("draw-update-received",e=>{let{studentId:t,drawData:s,canvasState:a}=e;(t===r||o&&i===t)&&(a?D(a):s&&P(s))}),t.on("canvas-state-update",e=>{let{studentId:t,canvasState:s}=e;t===r&&s&&D(s)}),t.on("load-canvas",e=>{let{studentId:t,canvasData:s}=e;t===r&&s&&D(s)}),()=>{t.off("draw-update-received"),t.off("canvas-state-update"),t.off("load-canvas")}},[t,r,s,o,i]);let D=e=>{let t=d.current,r=null==t?void 0:t.getContext("2d");if(!t||!r)return;let s=new Image;s.onload=()=>{r.clearRect(0,0,t.width,t.height),r.drawImage(s,0,0)},s.src=e},P=e=>{var t;let r=d.current,s=null==r?void 0:r.getContext("2d");if(r&&s&&(null==e?void 0:null===(t=e.points)||void 0===t?void 0:t.length)){s.beginPath(),s.moveTo(e.points[0].x,e.points[0].y),"erase"===e.type?(s.globalCompositeOperation="destination-out",s.strokeStyle="rgba(0,0,0,1)"):(s.globalCompositeOperation="source-over",s.strokeStyle=e.color),s.lineWidth=2,s.lineCap="round";for(let t=1;t<e.points.length;t++)s.lineTo(e.points[t].x,e.points[t].y);s.stroke(),s.closePath(),s.globalCompositeOperation="source-over"}},I=e=>{let t=d.current;if(!t)return null;let r=t.getBoundingClientRect(),s=t.width/r.width,a=t.height/r.height;return{x:(e.clientX-r.left)*s,y:(e.clientY-r.top)*a}},L=()=>{u(!1),z(null);let e=d.current;if(e&&!o){let a=e.toDataURL();t.emit("draw-update",{classCode:s,studentId:r,drawData:null,canvasState:a})}};return(0,a.jsxs)("div",{className:"relative border border-input rounded-lg shadow-md",onClick:l,children:[(0,a.jsx)("canvas",{ref:d,className:"touch-none w-full h-full rounded-lg",style:{aspectRatio:"4/3"},onPointerDown:e=>{if(o){l&&l();return}let t=I(e);t&&(u(!0),z(t),P({points:[t],color:"erase"===j?"#ffffff":f,width:2,type:j}))},onPointerMove:e=>{if(!c||o||!_)return;let a=I(e);if(!a)return;let n={points:[_,a],color:"erase"===j?"#ffffff":f,width:2,type:j};P(n);let l=d.current;if(l){let e=l.toDataURL();t.emit("draw-update",{classCode:s,studentId:r,drawData:n,canvasState:e})}z(a)},onPointerUp:L,onPointerLeave:L}),!o&&(0,a.jsxs)("div",{className:"absolute bottom-4 left-4 flex gap-2 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 p-2 rounded-lg shadow-md border border-input",children:[(0,a.jsx)(p,{children:(0,a.jsxs)(m,{children:[(0,a.jsx)(g,{asChild:!0,children:(0,a.jsxs)(v,{children:[(0,a.jsx)(w,{asChild:!0,children:(0,a.jsx)(x,{variant:"outline",size:"icon",className:"w-8 h-8 rounded-md",style:{backgroundColor:f},children:(0,a.jsx)("span",{className:"sr-only",children:"Pick color"})})}),(0,a.jsx)(N,{className:"w-auto p-2",children:(0,a.jsx)("input",{type:"color",value:f,onChange:e=>h(e.target.value),className:"w-32 h-8"})})]})}),(0,a.jsx)(b,{children:(0,a.jsx)("p",{children:"Pick color"})})]})}),(0,a.jsx)(C,{orientation:"vertical",className:"mx-1"}),(0,a.jsx)(p,{children:(0,a.jsxs)(m,{children:[(0,a.jsx)(g,{asChild:!0,children:(0,a.jsxs)(x,{onClick:()=>y("draw"),variant:"draw"===j?"default":"secondary",size:"sm",className:"px-3",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[(0,a.jsx)("path",{d:"M12 19l7-7 3 3-7 7-3-3z"}),(0,a.jsx)("path",{d:"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}),(0,a.jsx)("path",{d:"M2 2l7.586 7.586"}),(0,a.jsx)("path",{d:"M11 11l-4 4"})]}),(0,a.jsx)("span",{className:"sr-only",children:"Draw"})]})}),(0,a.jsx)(b,{children:(0,a.jsx)("p",{children:"Draw"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(m,{children:[(0,a.jsx)(g,{asChild:!0,children:(0,a.jsxs)(x,{onClick:()=>y("erase"),variant:"erase"===j?"default":"secondary",size:"sm",className:"px-3",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-4 h-4",children:[(0,a.jsx)("path",{d:"M3 20h18"}),(0,a.jsx)("path",{d:"M15 5l5 5"}),(0,a.jsx)("path",{d:"M20 5l-5 5"})]}),(0,a.jsx)("span",{className:"sr-only",children:"Erase"})]})}),(0,a.jsx)(b,{children:(0,a.jsx)("p",{children:"Erase"})})]})}),(0,a.jsx)(p,{children:(0,a.jsxs)(m,{children:[(0,a.jsx)(g,{asChild:!0,children:(0,a.jsx)(x,{onClick:()=>{let e=d.current,a=null==e?void 0:e.getContext("2d");if(!e||!a)return;a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height);let n=e.toDataURL();t.emit("draw-update",{classCode:s,studentId:r,drawData:null,canvasState:n})},variant:"outline",size:"icon",className:"w-8 h-8",children:(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5",children:[(0,a.jsx)("path",{d:"M4 12h16"}),(0,a.jsx)("path",{d:"M12 4v16"})]})})}),(0,a.jsx)(b,{children:(0,a.jsx)("p",{children:"Clear canvas"})})]})})]})]})}let z=n.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:u("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...n})});z.displayName="Input";let S=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});S.displayName="Card",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("flex flex-col space-y-1.5 p-6",r),...s})}).displayName="CardHeader",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:u("text-2xl font-semibold leading-none tracking-tight",r),...s})}).displayName="CardTitle",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:u("text-sm text-muted-foreground",r),...s})}).displayName="CardDescription";let R=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("p-6",r),...s})});R.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter";let D=["Happy","Clever","Brave","Swift","Bright","Calm","Wise","Kind","Gentle","Smart","Quick","Lively","Peaceful","Cheerful","Eager","Friendly"],P=["Panda","Dolphin","Eagle","Lion","Tiger","Bear","Wolf","Fox","Hawk","Deer","Owl","Duck","Frog","Cat","Dog","Bird"];function I(){let[e,t]=(0,n.useState)(!1),[r,l]=(0,n.useState)(!1),[i,d]=(0,n.useState)(""),[c,u]=(0,n.useState)(""),[f,h]=(0,n.useState)(""),[p,m]=(0,n.useState)([]),[g,b]=(0,n.useState)(null),[j,v]=(0,n.useState)(null),[w,N]=(0,n.useState)(""),[y,C]=(0,n.useState)("");(0,n.useEffect)(()=>((async()=>{console.log("⚡ initializing socket...");try{s=(0,o.io)("https://galleryboard.onrender.com/",{transports:["websocket"],withCredentials:!1,reconnectionAttempts:5,reconnectionDelay:1e3,autoConnect:!0}),console.log("✅ socket.io initialized"),s.on("connect",()=>{if(console.log("Connected to server. Socket ID:",s.id),t(!0),v(null),s.id){h(s.id);let e=function(){let e=D[Math.floor(Math.random()*D.length)],t=P[Math.floor(Math.random()*P.length)];return"".concat(e," ").concat(t)}();N(e),C(e)}}),s.on("connect_error",e=>{console.error("\uD83D\uDD34 Socket connection error:",e),console.error("Socket connection error:",e),v("Failed to connect to GalleryBoard server. Please try again."),t(!1)}),s.on("classroom-created",e=>{let{classCode:t}=e;d(t),window.history.pushState(null,"","?classCode=".concat(t,"&mode=teacher"))}),s.on("student-joined",e=>{let{students:t}=e;m(t)}),s.on("student-left",e=>{let{students:t}=e;m(t)})}catch(e){console.error("Failed to initialize connection:",e),v("Failed to initialize connection. Please refresh the page.")}})(),()=>{s&&s.disconnect()}),[]);let k=e=>{m(t=>t.filter(t=>t.id!==e)),s.emit("remove-student",{studentId:e,classCode:i})};return((0,n.useEffect)(()=>{r&&g&&s.emit("request-canvas-state",{studentId:g,classCode:i})},[r,g,i]),e)?i?r?(0,a.jsxs)("div",{className:"p-8 h-screen bg-[linear-gradient(to_right,#73737320_1px,transparent_1px),linear-gradient(to_bottom,#73737320_1px,transparent_1px)]  bg-[size:20px_20px]",children:[(0,a.jsx)(S,{className:"mb-6",children:(0,a.jsx)(R,{className:"p-6",children:(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-black",children:["Room Code: ",i]}),(0,a.jsxs)("p",{className:"text-gray-500",children:["Connected Guests: ",p.length]})]})})})}),g?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col bg-white",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 shadow",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold",children:["Viewing ",g,"'s Board"]}),(0,a.jsx)("button",{onClick:()=>b(null),className:"border border-gray-400 rounded px-3 py-1",children:"Close Full Screen"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto p-4",children:(0,a.jsx)(_,{socket:s,studentId:g,classCode:i,isTeacher:!0})})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:p.map(e=>(0,a.jsxs)(S,{className:"relative cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>b(e.id),children:[(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),k(e.id)},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center",children:"X"}),(0,a.jsxs)(R,{className:"p-4",children:[(0,a.jsx)(_,{socket:s,studentId:e.id,classCode:i,isTeacher:!0}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-black",children:e.displayName})]})]},e.id))})]}):(0,a.jsxs)("div",{className:"p-8 bg-[linear-gradient(to_right,#73737320_1px,transparent_1px),linear-gradient(to_bottom,#73737320_1px,transparent_1px)]  bg-[size:20px_20px]",children:[(0,a.jsx)(S,{className:"mb-6",children:(0,a.jsxs)(R,{className:"p-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-700",children:["Room Code: ",i]}),(0,a.jsxs)("p",{className:"text-gray-500",children:["Your Name: ",w]})]})}),(0,a.jsx)(S,{children:(0,a.jsx)(R,{className:"p-6",children:(0,a.jsx)(_,{socket:s,studentId:f,classCode:i})})})]}):(0,a.jsx)("div",{className:"flex flex-col items-center justify-center p-4 min-h-screen bg-[linear-gradient(to_right,#73737320_1px,transparent_1px),linear-gradient(to_bottom,#73737320_1px,transparent_1px)]  bg-[size:20px_20px]",children:(0,a.jsxs)(S,{className:"w-full max-w-md border-none",children:[(0,a.jsx)("img",{src:"/galleryboardlogo.png",alt:"Logo",className:"h-[225px] w-auto"}),(0,a.jsxs)(R,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(z,{type:"text",value:c,onChange:e=>u(e.target.value.toUpperCase()),placeholder:"Enter room code",className:"text-center"}),(0,a.jsx)(x,{onClick:()=>{s.id&&c&&(s.emit("join-classroom",{classCode:c,studentId:s.id,displayName:w}),d(c),window.history.pushState(null,"","?classCode=".concat(c,"&mode=student")))},size:"lg",className:"w-full bg-blue-500 text-white hover:bg-blue-600",children:"Join Room"})]}),(0,a.jsx)(x,{onClick:()=>{if(!s||!s.connected){v("Socket not connected yet. Please wait a moment.");return}l(!0),s.id?s.emit("create-classroom",s.id):v("Socket ID is undefined. Please try again.")},variant:"outline",className:"w-full text-blue-600 border-blue-600 hover:bg-blue-50",size:"lg",children:"Create Room"})]})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-[linear-gradient(to_right,#73737320_1px,transparent_1px),linear-gradient(to_bottom,#73737320_1px,transparent_1px)]  bg-[size:20px_20px]",children:(0,a.jsx)(S,{className:"w-full max-w-md bg-[#fdfdfd] border-2 border-[#e6e4e0] rounded-lg",children:(0,a.jsxs)(R,{className:"p-6 space-y-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),(0,a.jsx)("p",{className:"text-center text-gray-700",children:j||"Connecting to GalleryBoard server..."}),j&&(0,a.jsx)(x,{onClick:()=>window.location.reload(),variant:"outline",className:"w-full",children:"Retry Connection"})]})})})}}},function(e){e.O(0,[440,971,69,744],function(){return e(e.s=4392)}),_N_E=e.O()}]);