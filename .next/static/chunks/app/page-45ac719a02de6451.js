(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4392:function(e,t,r){Promise.resolve().then(r.bind(r,8098))},8098:function(e,t,r){"use strict";let s;r.r(t),r.d(t,{default:function(){return y}});var a=r(7437),n=r(2265),l=r(6782),o=r(6371),i=r(9769),d=r(3167),c=r(1367);function u(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,c.m6)((0,d.W)(t))}let f=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-xs hover:bg-destructive/90",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),m=n.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:l=!1,...i}=e,d=l?o.g7:"button";return(0,a.jsx)(d,{className:u(f({variant:s,size:n,className:r})),ref:t,...i})});function h(e){let{socket:t,studentId:r,classCode:s,isTeacher:l,onBoardClick:o}=e,i=(0,n.useRef)(null),[d,c]=(0,n.useState)(!1),[u,f]=(0,n.useState)("#000000"),[h,x]=(0,n.useState)(2),[p,g]=(0,n.useState)("draw"),[v,j]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=i.current;if(!e)return;let a=e.getContext("2d");if(a)return a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),l&&t.emit("request-canvas-state",{classCode:s,studentId:r}),t.on("draw-update-received",e=>{let{studentId:t,drawData:s,canvasState:a}=e;t===r&&(a?b(a):s&&w(s))}),t.on("canvas-state-update",e=>{let{studentId:t,canvasState:s}=e;t===r&&s&&b(s)}),()=>{t.off("draw-update-received"),t.off("canvas-state-update")}},[t,r,s,l]);let b=e=>{let t=i.current,r=null==t?void 0:t.getContext("2d");if(!t||!r)return;let s=new Image;s.onload=()=>{r.clearRect(0,0,t.width,t.height),r.drawImage(s,0,0)},s.src=e},w=e=>{var t;let r=i.current,s=null==r?void 0:r.getContext("2d");if(r&&s&&(null==e?void 0:null===(t=e.points)||void 0===t?void 0:t.length)){s.beginPath(),s.moveTo(e.points[0].x,e.points[0].y),"erase"===e.type?(s.globalCompositeOperation="destination-out",s.strokeStyle="rgba(0,0,0,1)"):(s.globalCompositeOperation="source-over",s.strokeStyle=e.color),s.lineWidth=e.width,s.lineCap="round";for(let t=1;t<e.points.length;t++)s.lineTo(e.points[t].x,e.points[t].y);s.stroke(),s.closePath(),s.globalCompositeOperation="source-over"}},N=()=>{c(!1),j(null);let e=i.current;if(e&&!l){let a=e.toDataURL();t.emit("draw-update",{classCode:s,studentId:r,drawData:null,canvasState:a})}};return(0,a.jsxs)("div",{className:"relative border border-input rounded-lg shadow-md",onClick:o,children:[(0,a.jsx)("canvas",{ref:i,width:600,height:400,className:"touch-none w-full h-full rounded-lg",onPointerDown:e=>{if(l){o&&o();return}let t=i.current;if(!t)return;let r=t.getBoundingClientRect(),s=e.clientX-r.left,a=e.clientY-r.top;c(!0),j({x:s,y:a})},onPointerMove:e=>{if(!d||l||!v)return;let a=i.current;if(!a)return;let n=a.getBoundingClientRect(),o=e.clientX-n.left,c=e.clientY-n.top,f={points:[v,{x:o,y:c}],color:u,width:h,type:p};w(f);let m=a.toDataURL();t.emit("draw-update",{classCode:s,studentId:r,drawData:f,canvasState:m}),j({x:o,y:c})},onPointerUp:N,onPointerLeave:N}),!l&&(0,a.jsx)("div",{className:"absolute bottom-4 left-4 flex gap-2 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 p-2 rounded-lg shadow-md border border-input",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"color",value:u,onChange:e=>f(e.target.value),className:"w-8 h-8 rounded cursor-pointer"}),(0,a.jsx)(m,{onClick:()=>g("draw"),variant:"draw"===p?"default":"secondary",size:"sm",children:"Draw"}),(0,a.jsx)(m,{onClick:()=>g("erase"),variant:"erase"===p?"default":"secondary",size:"sm",children:"Erase"}),(0,a.jsx)(m,{onClick:()=>{let e=i.current,a=null==e?void 0:e.getContext("2d");if(!e||!a)return;a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height);let n=e.toDataURL();t.emit("draw-update",{classCode:s,studentId:r,drawData:null,canvasState:n})},variant:"destructive",size:"sm",children:"Clear"})]})})]})}m.displayName="Button";let x=n.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:u("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...n})});x.displayName="Input";let p=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("rounded-xl border bg-card text-card-foreground shadow",r),...s})});p.displayName="Card";let g=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("flex flex-col space-y-1.5 p-6",r),...s})});g.displayName="CardHeader";let v=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:u("font-semibold leading-none tracking-tight",r),...s})});v.displayName="CardTitle",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:u("text-sm text-muted-foreground",r),...s})}).displayName="CardDescription";let j=n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("p-6 pt-0",r),...s})});j.displayName="CardContent",n.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:u("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter";let b=["Happy","Clever","Bright","Swift","Gentle","Bold","Calm","Wise","Kind","Quick","Brave","Smart","Eager","Fair","Pure","Warm","Sharp","Fresh","Noble","Proud"],w=["Panda","Eagle","Tiger","Dolphin","Lion","Wolf","Bear","Fox","Hawk","Deer","Owl","Swan","Horse","Robin","Dove","Seal","Lynx","Elk","Hare","Crane"];var N=r(9079);function y(){let[e,t]=(0,n.useState)(!1),[r,o]=(0,n.useState)(!1),[i,d]=(0,n.useState)(""),[c,u]=(0,n.useState)(""),[f,y]=(0,n.useState)(""),[C,k]=(0,n.useState)([]),[S,R]=(0,n.useState)(null),[B,P]=(0,n.useState)(null),[E,D]=(0,n.useState)("");return((0,n.useEffect)(()=>{try{return(s=(0,l.io)(N.env.NEXT_PUBLIC_SOCKET_URL||"http://localhost:3001",{transports:["websocket"]})).on("connect",()=>{if(console.log("Connected to server"),t(!0),P(null),s.id){y(s.id);let e=function(){let e=b[Math.floor(Math.random()*b.length)],t=w[Math.floor(Math.random()*w.length)];return"".concat(e).concat(t)}();D(e),console.log("Generated name:",e)}}),s.on("connect_error",e=>{console.error("Connection error:",e),P("Failed to connect to GalleryBoard server. Please try connecting again."),t(!1)}),s.on("classroom-created",e=>{let{classCode:t}=e;d(t)}),s.on("student-joined",e=>{let{studentId:t,displayName:r,students:s}=e;console.log("Student joined:",{studentId:t,displayName:r}),k(s)}),s.on("name-assigned",e=>{let{displayName:t}=e;console.log("Name assigned:",t),D(t)}),s.on("student-left",e=>{let{students:t}=e;k(t)}),()=>{s.disconnect()}}catch(e){console.error("Socket initialization error:",e),P("Failed to initialize connection. Please refresh the page.")}},[]),e)?i?r?(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)(p,{className:"mb-6",children:(0,a.jsx)(j,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold",children:["Class Code: ",i]}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:["Connected Students: ",C.length]})]}),S&&(0,a.jsx)(m,{onClick:()=>R(null),variant:"outline",children:"Back to Grid"})]})})}),S?(0,a.jsx)(p,{children:(0,a.jsx)(j,{className:"p-6",children:(0,a.jsx)(h,{socket:s,studentId:S,classCode:i,isTeacher:!0})})}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:C.map(e=>(0,a.jsx)(p,{className:"cursor-pointer hover:shadow-lg transition-shadow",children:(0,a.jsxs)(j,{className:"p-4",children:[(0,a.jsx)(h,{socket:s,studentId:e.id,classCode:i,isTeacher:!0,onBoardClick:()=>R(e.id)}),(0,a.jsx)("p",{className:"mt-2 text-center text-sm text-muted-foreground",children:e.displayName})]})},e.id))})]}):(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)(p,{className:"mb-6",children:(0,a.jsxs)(j,{className:"p-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold",children:["Class Code: ",i]}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:["Your Name: ",E]})]})}),(0,a.jsx)(p,{children:(0,a.jsx)(j,{className:"p-6",children:(0,a.jsx)(h,{socket:s,studentId:f,classCode:i})})})]}):(0,a.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:(0,a.jsxs)(p,{className:"w-full max-w-md",children:[(0,a.jsx)(g,{children:(0,a.jsx)(v,{className:"text-2xl text-center",children:"GalleryBoard"})}),(0,a.jsxs)(j,{className:"space-y-4",children:[(0,a.jsx)(m,{onClick:()=>{s.id&&(o(!0),s.emit("create-classroom",s.id))},className:"w-full",size:"lg",children:"Create Classroom (Teacher)"}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)(x,{type:"text",value:c,onChange:e=>u(e.target.value.toUpperCase()),placeholder:"Enter class code",className:"text-center"}),(0,a.jsx)(m,{onClick:()=>{s.id&&c&&(console.log("Joining classroom with name:",E),s.emit("join-classroom",{classCode:c,studentId:s.id,displayName:E}),d(c))},variant:"secondary",size:"lg",children:"Join Classroom"})]})]})]})}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsx)(p,{children:(0,a.jsxs)(j,{className:"p-6",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),(0,a.jsx)("p",{className:"text-center mt-4",children:B||"Connecting to GalleryBoard server..."}),B&&(0,a.jsx)(m,{onClick:()=>window.location.reload(),variant:"outline",className:"mt-4 w-full",children:"Retry Connection"})]})})})}}},function(e){e.O(0,[248,971,69,744],function(){return e(e.s=4392)}),_N_E=e.O()}]);