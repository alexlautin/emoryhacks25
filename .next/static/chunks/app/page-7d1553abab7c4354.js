(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8924:function(){},5024:function(){},4392:function(e,t,n){Promise.resolve().then(n.bind(n,2957))},2957:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r=n(7437),s=n(2265),o=n(9787),a=n.n(o),l=n(4480),i=n.n(l),c=n(9079);new(a())({appId:"1962551",key:"0a97d4aa577b7a7831d5",secret:c.env.PUSHER_SECRET,cluster:"us2",useTLS:!0}),i().logToConsole=!0;let d=new(i())("0a97d4aa577b7a7831d5",{cluster:"us2",forceTLS:!0,enabledTransports:["ws","wss"],authEndpoint:"/api/pusher/auth",auth:{headers:{"Content-Type":"application/json"}}});var u=n(6371),p=n(9769),h=n(3167),f=n(1367);function m(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,f.m6)((0,h.W)(t))}let g=(0,p.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-xs hover:bg-destructive/90",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),x=s.forwardRef((e,t)=>{let{className:n,variant:s,size:o,asChild:a=!1,...l}=e,i=a?u.g7:"button";return(0,r.jsx)(i,{className:m(g({variant:s,size:o,className:n})),ref:t,...l})});function b(e){let{socket:t,studentId:n,classCode:o,isTeacher:a=!1,onBoardClick:l}=e,i=(0,s.useRef)(null),[c,d]=(0,s.useState)(!1),[u,p]=(0,s.useState)("#000000"),[h,f]=(0,s.useState)(2),[m,g]=(0,s.useState)("draw"),[b,y]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=i.current;if(!e)return;let r=e.getContext("2d");if(!r)return;r.strokeStyle=u,r.lineWidth=h,r.lineCap="round",r.lineJoin="round";let s=t.subscribe("classroom-".concat(o));return s.bind("draw-update",t=>{if(t.studentId!==n||a){if(t.drawData)v(t.drawData);else if(t.canvasState){let n=new Image;n.onload=()=>{r.clearRect(0,0,e.width,e.height),r.drawImage(n,0,0)},n.src=t.canvasState}}}),()=>{s.unbind_all(),t.unsubscribe("classroom-".concat(o))}},[t,o,n,u,h,a]);let j=()=>{d(!1),y(null)},v=e=>{var t;let n=i.current,r=null==n?void 0:n.getContext("2d");if(n&&r&&(null==e?void 0:null===(t=e.points)||void 0===t?void 0:t.length)){r.beginPath(),r.moveTo(e.points[0].x,e.points[0].y),"erase"===e.type?(r.globalCompositeOperation="destination-out",r.strokeStyle="rgba(0,0,0,1)"):(r.globalCompositeOperation="source-over",r.strokeStyle=e.color),r.lineWidth=e.width,r.lineCap="round",r.lineJoin="round";for(let t=1;t<e.points.length;t++)r.lineTo(e.points[t].x,e.points[t].y);r.stroke(),r.closePath(),r.globalCompositeOperation="source-over"}};return(0,r.jsxs)("div",{className:"relative border border-input rounded-lg shadow-md",onClick:l,children:[(0,r.jsx)("canvas",{ref:i,width:600,height:400,className:"touch-none w-full h-full rounded-lg ".concat(a?"cursor-default":"cursor-crosshair"," ").concat(l?"cursor-pointer":""),onMouseDown:e=>{if(a)return;let t=i.current;if(!t)return;let n=t.getBoundingClientRect(),r=e.clientX-n.left,s=e.clientY-n.top;d(!0),y({x:r,y:s})},onMouseMove:e=>{if(!c||a)return;let t=i.current;if(!t||!t.getContext("2d")||!b)return;let r=t.getBoundingClientRect(),s=e.clientX-r.left,l=e.clientY-r.top,d={points:[b,{x:s,y:l}],color:u,width:h,type:m};v(d),fetch("/api/pusher",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"draw-update",classCode:o,studentId:n,drawData:d,canvasState:null})}).catch(console.error),y({x:s,y:l})},onMouseUp:j,onMouseOut:j,onClick:l}),!a&&(0,r.jsx)("div",{className:"absolute bottom-4 left-4 flex gap-2 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 p-2 rounded-lg shadow-md border border-input",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"color",value:u,onChange:e=>p(e.target.value),className:"w-8 h-8 rounded cursor-pointer"}),(0,r.jsx)(x,{onClick:()=>g("draw"),variant:"draw"===m?"default":"secondary",size:"sm",children:"Draw"}),(0,r.jsx)(x,{onClick:()=>g("erase"),variant:"erase"===m?"default":"secondary",size:"sm",children:"Erase"}),(0,r.jsx)(x,{onClick:()=>{let e=i.current,t=null==e?void 0:e.getContext("2d");if(!e||!t)return;t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height);let r=e.toDataURL("image/jpeg",.5);fetch("/api/pusher",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"draw-update",classCode:o,studentId:n,drawData:null,canvasState:r})}).catch(console.error)},variant:"destructive",size:"sm",children:"Clear"})]})})]})}x.displayName="Button";let y=s.forwardRef((e,t)=>{let{className:n,type:s,...o}=e;return(0,r.jsx)("input",{type:s,className:m("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...o})});y.displayName="Input";let j=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:m("rounded-xl border bg-card text-card-foreground shadow",n),...s})});j.displayName="Card";let v=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:m("flex flex-col space-y-1.5 p-6",n),...s})});v.displayName="CardHeader";let C=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("h3",{ref:t,className:m("font-semibold leading-none tracking-tight",n),...s})});C.displayName="CardTitle",s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("p",{ref:t,className:m("text-sm text-muted-foreground",n),...s})}).displayName="CardDescription";let w=s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:m("p-6 pt-0",n),...s})});w.displayName="CardContent",s.forwardRef((e,t)=>{let{className:n,...s}=e;return(0,r.jsx)("div",{ref:t,className:m("flex items-center p-6 pt-0",n),...s})}).displayName="CardFooter";let N=["Happy","Clever","Brave","Swift","Bright","Calm","Wise","Kind","Gentle","Smart","Quick","Lively","Peaceful","Cheerful","Eager","Friendly"],S=["Panda","Dolphin","Eagle","Lion","Tiger","Bear","Wolf","Fox","Hawk","Deer","Owl","Duck","Frog","Cat","Dog","Bird"];function k(){let[e,t]=(0,s.useState)(!1),[n,o]=(0,s.useState)(!1),[a,l]=(0,s.useState)(""),[i,c]=(0,s.useState)(""),[u,p]=(0,s.useState)(""),[h,f]=(0,s.useState)([]),[m,g]=(0,s.useState)(null),[k,T]=(0,s.useState)(null),[O,R]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=Math.random().toString(36).substring(2,15);return p(e),R(function(){let e=N[Math.floor(Math.random()*N.length)],t=S[Math.floor(Math.random()*S.length)];return"".concat(e," ").concat(t)}()),d.connection.bind("connected",()=>{console.log("Pusher connected successfully"),t(!0),T(null)}),d.connection.bind("error",e=>{console.error("Pusher connection error:",e),t(!1),T("Connection error: ".concat(e.message||"Unknown error")),setTimeout(()=>{console.log("Attempting to reconnect..."),d.connect()},3e3)}),d.connection.bind("disconnected",()=>{console.log("Pusher disconnected"),t(!1),T("Disconnected from server. Attempting to reconnect..."),setTimeout(()=>{console.log("Attempting to reconnect..."),d.connect()},3e3)}),d.connection.bind("connecting",()=>{console.log("Connecting to Pusher..."),t(!1),T("Connecting to server...")}),"connected"!==d.connection.state&&(console.log("Initializing Pusher connection..."),d.connect()),()=>{a&&fetch("/api/pusher",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"leave-classroom",classCode:a,studentId:e})}).catch(console.error),d.disconnect(),d.connection.unbind_all()}},[]),(0,s.useEffect)(()=>{if(!a)return;let e=d.subscribe("classroom-".concat(a));return e.bind("classroom-created",e=>{console.log("Classroom created:",e.classCode),l(e.classCode)}),e.bind("student-joined",e=>{console.log("Student joined:",e),f(e.students)}),e.bind("student-left",e=>{f(e.students)}),()=>{d.unsubscribe("classroom-".concat(a))}},[a]);let E=async()=>{try{let e=await fetch("/api/pusher",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"create-classroom",teacherId:u})}),t=await e.json();t.classCode&&(o(!0),l(t.classCode))}catch(e){console.error("Error creating classroom:",e),T("Failed to create classroom")}},P=async()=>{if(i)try{let e=await fetch("/api/pusher",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"join-classroom",classCode:i.toUpperCase(),studentId:u,displayName:O})}),t=await e.json();if(t.error){T(t.error);return}l(i.toUpperCase())}catch(e){console.error("Error joining classroom:",e),T("Failed to join classroom")}};return e?a?n?(0,r.jsxs)("div",{className:"p-8",children:[(0,r.jsx)(j,{className:"mb-6",children:(0,r.jsx)(w,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold",children:["Class Code: ",a]}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Connected Students: ",h.length]})]}),m&&(0,r.jsx)(x,{onClick:()=>g(null),variant:"outline",children:"Back to Grid"})]})})}),m?(0,r.jsx)(j,{children:(0,r.jsx)(w,{className:"p-6",children:(0,r.jsx)(b,{socket:d,studentId:m,classCode:a,isTeacher:!0})})}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:h.map(e=>(0,r.jsx)(j,{className:"cursor-pointer hover:shadow-lg transition-shadow",children:(0,r.jsxs)(w,{className:"p-4",children:[(0,r.jsx)(b,{socket:d,studentId:e.id,classCode:a,isTeacher:!0,onBoardClick:()=>g(e.id)}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-muted-foreground",children:e.displayName})]})},e.id))})]}):(0,r.jsxs)("div",{className:"p-8",children:[(0,r.jsx)(j,{className:"mb-6",children:(0,r.jsxs)(w,{className:"p-6",children:[(0,r.jsxs)("h2",{className:"text-2xl font-bold",children:["Class Code: ",a]}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Your Name: ",O]})]})}),(0,r.jsx)(j,{children:(0,r.jsx)(w,{className:"p-6",children:(0,r.jsx)(b,{socket:d,studentId:u,classCode:a})})})]}):(0,r.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:(0,r.jsxs)(j,{className:"w-full max-w-md",children:[(0,r.jsx)(v,{children:(0,r.jsx)(C,{className:"text-2xl text-center",children:"GalleryBoard"})}),(0,r.jsxs)(w,{className:"space-y-4",children:[(0,r.jsx)(x,{onClick:E,className:"w-full",size:"lg",children:"Create Classroom (Teacher)"}),(0,r.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,r.jsx)(y,{type:"text",value:i,onChange:e=>c(e.target.value.toUpperCase()),placeholder:"Enter class code",className:"text-center"}),(0,r.jsx)(x,{onClick:P,variant:"secondary",size:"lg",children:"Join Classroom"})]})]})]})}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(j,{children:(0,r.jsxs)(w,{className:"p-6",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),(0,r.jsx)("p",{className:"text-center mt-4",children:k||"Connecting to GalleryBoard server now..."}),k&&(0,r.jsx)(x,{onClick:()=>window.location.reload(),variant:"outline",className:"mt-4 w-full",children:"Retry Connection"})]})})})}}},function(e){e.O(0,[218,444,971,69,744],function(){return e(e.s=4392)}),_N_E=e.O()}]);