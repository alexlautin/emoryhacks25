"use strict";(()=>{var e={};e.id=227,e.ids=[227],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},4300:e=>{e.exports=require("buffer")},2081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},1442:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>v});var s={};t.r(s),t.d(s,{POST:()=>i});var o=t(5419),a=t(9108),n=t(9678),u=t(8984),l=t(4370);let c=new Map;async function i(e){try{console.log("Pusher API request received");let{type:r,...t}=await e.json();switch(console.log("Event type:",r,"Data:",t),r){case"create-classroom":{let e;let{teacherId:r}=t;do e=Math.random().toString(36).substring(2,8).toUpperCase();while(c.has(e));c.set(e,{teacherId:r,students:new Map}),console.log(`Creating classroom ${e} for teacher ${r}`);try{await l.o.trigger(`classroom-${e}`,"classroom-created",{classCode:e,teacherId:r}),console.log("Classroom created event sent successfully")}catch(e){throw console.error("Error triggering Pusher event:",e),e}return u.NextResponse.json({classCode:e})}case"join-classroom":{let{classCode:e,studentId:r,displayName:s}=t,o=c.get(e);if(!o)return console.log(`Classroom ${e} not found`),u.NextResponse.json({error:"Classroom not found"},{status:404});o.students.set(r,{displayName:s}),console.log(`Student ${r} (${s}) joining classroom ${e}`);try{await l.o.trigger(`classroom-${e}`,"student-joined",{studentId:r,displayName:s,students:Array.from(o.students.entries()).map(([e,r])=>({id:e,displayName:r.displayName}))}),console.log("Student joined event sent successfully")}catch(e){throw console.error("Error triggering Pusher event:",e),e}return u.NextResponse.json({success:!0})}case"draw-update":{let{classCode:e,studentId:r,drawData:s,canvasState:o}=t;console.log(`Draw update from student ${r} in classroom ${e}`);try{let t={studentId:r,drawData:s,canvasState:o&&o.length<1e4?o:null};await l.o.trigger(`classroom-${e}`,"draw-update",t),console.log("Draw update event sent successfully")}catch(t){if(console.error("Error triggering Pusher event:",t),t instanceof Error&&t.message.includes("413"))try{await l.o.trigger(`classroom-${e}`,"draw-update",{studentId:r,drawData:s,canvasState:null}),console.log("Draw update event sent successfully without canvas state")}catch(e){throw e}else throw t}return u.NextResponse.json({success:!0})}case"leave-classroom":{let{classCode:e,studentId:r}=t,s=c.get(e);if(s){s.students.delete(r),console.log(`Student ${r} leaving classroom ${e}`);try{await l.o.trigger(`classroom-${e}`,"student-left",{students:Array.from(s.students.entries()).map(([e,r])=>({id:e,displayName:r.displayName}))}),console.log("Student left event sent successfully")}catch(e){throw console.error("Error triggering Pusher event:",e),e}0===s.students.size&&s.teacherId===r&&(c.delete(e),console.log(`Classroom ${e} deleted`))}return u.NextResponse.json({success:!0})}default:return console.log("Invalid event type:",r),u.NextResponse.json({error:"Invalid event type"},{status:400})}}catch(e){return console.error("Pusher API error:",e),u.NextResponse.json({error:"Internal server error",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pusher/route",pathname:"/api/pusher",filename:"route",bundlePath:"app/api/pusher/route"},resolvedPagePath:"/Users/alexlautin/Documents/GitHub/emoryhacks25/app/api/pusher/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:m,staticGenerationBailout:v}=p,w="/api/pusher/route";function x(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},4370:(e,r,t)=>{t.d(r,{o:()=>u});var s=t(5571),o=t.n(s),a=t(1572),n=t.n(a);let u=new(o())({appId:"1962551",key:"0a97d4aa577b7a7831d5",secret:process.env.PUSHER_SECRET,cluster:"us2",useTLS:!0});new(n())("0a97d4aa577b7a7831d5",{cluster:"us2",forceTLS:!0,enabledTransports:["ws","wss"],authEndpoint:"/api/pusher/auth",auth:{headers:{"Content-Type":"application/json"}}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,295],()=>t(1442));module.exports=s})();